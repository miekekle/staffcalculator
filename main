import { useState } from 'react';

export default function StaffingCalculator() {
  const [employees, setEmployees] = useState(28000);
  const [parentPct, setParentPct] = useState(15);
  const [uptakePct, setUptakePct] = useState(30);
  const [elderUptakePct, setElderUptakePct] = useState(10);
  const [elderDepPct, setElderDepPct] = useState(20);
  
  // Child age distribution assumptions
  const babyPct = 0.25, toddlerPct = 0.35, over3Pct = 0.40;
  
  // Ratios (England)
  const babyRatio = 3, toddlerRatio = 5, over3Ratio = 8, elderRatio = 8;
  
  const parentEmployees = employees * (parentPct / 100);
  const childcareUsers = parentEmployees * (uptakePct / 100);
  
  const babies = Math.ceil(childcareUsers * babyPct);
  const toddlers = Math.ceil(childcareUsers * toddlerPct);
  const over3 = Math.ceil(childcareUsers * over3Pct);
  const totalChildren = babies + toddlers + over3;
  
  const babyStaff = Math.ceil(babies / babyRatio);
  const toddlerStaff = Math.ceil(toddlers / toddlerRatio);
  const over3Staff = Math.ceil(over3 / over3Ratio);
  const totalChildcareStaff = babyStaff + toddlerStaff + over3Staff;
  
  const elderDepEmployees = employees * (elderDepPct / 100);
  const elderUsers = Math.ceil(elderDepEmployees * (elderUptakePct / 100));
  const elderStaff = Math.ceil(elderUsers / elderRatio);
  
  const totalCareStaff = totalChildcareStaff + elderStaff;
  const supportStaff = Math.ceil(totalCareStaff * 0.2);
  const totalStaff = totalCareStaff + supportStaff;

  const Slider = ({ label, value, onChange, min, max, unit = '%' }) => (
    <div className="mb-4">
      <div className="flex justify-between text-sm mb-1">
        <span className="text-gray-600">{label}</span>
        <span className="font-medium text-gray-900">{value.toLocaleString()}{unit}</span>
      </div>
      <input type="range" min={min} max={max} value={value} onChange={e => onChange(Number(e.target.value))}
        className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"/>
    </div>
  );

  const StatCard = ({ label, value, sub, color = 'indigo' }) => (
    <div className={`bg-${color}-50 rounded-lg p-4 border border-${color}-100`}>
      <div className={`text-2xl font-bold text-${color}-700`}>{value}</div>
      <div className="text-sm text-gray-600">{label}</div>
      {sub && <div className="text-xs text-gray-500 mt-1">{sub}</div>}
    </div>
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-indigo-50 p-6">
      <div className="max-w-4xl mx-auto">
        <div className="mb-6">
          <h1 className="text-2xl font-bold text-gray-900">Porto Dome Staffing Calculator</h1>
          <p className="text-gray-500">NHS Trust Pilot Estimation</p>
        </div>

        <div className="grid md:grid-cols-2 gap-6">
          <div className="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
            <h2 className="font-semibold text-gray-800 mb-4">Parameters</h2>
            <Slider label="Total Employees" value={employees} onChange={setEmployees} min={0} max={30000} unit=""/>
            <Slider label="Employees with young children" value={parentPct} onChange={setParentPct} min={5} max={30}/>
            <Slider label="Childcare uptake rate" value={uptakePct} onChange={setUptakePct} min={10} max={80}/>
            <Slider label="Employees with elder dependents" value={elderDepPct} onChange={setElderDepPct} min={5} max={40}/>
            <Slider label="Eldercare uptake rate" value={elderUptakePct} onChange={setElderUptakePct} min={5} max={50}/>
            
            <div className="mt-4 p-3 bg-gray-50 rounded-lg text-xs text-gray-500">
              <strong>Ratios (England):</strong> Babies 1:3 | Toddlers 1:5 | Over 3s 1:8 | Elders ~1:8
            </div>
          </div>

          <div className="space-y-4">
            <div className="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
              <h2 className="font-semibold text-gray-800 mb-4">Childcare Breakdown</h2>
              <div className="grid grid-cols-3 gap-3 text-center text-sm">
                <div className="bg-pink-50 rounded-lg p-3">
                  <div className="font-bold text-pink-700">{babies}</div>
                  <div className="text-gray-500">Babies</div>
                  <div className="text-xs text-pink-600">{babyStaff} staff</div>
                </div>
                <div className="bg-orange-50 rounded-lg p-3">
                  <div className="font-bold text-orange-700">{toddlers}</div>
                  <div className="text-gray-500">Toddlers</div>
                  <div className="text-xs text-orange-600">{toddlerStaff} staff</div>
                </div>
                <div className="bg-green-50 rounded-lg p-3">
                  <div className="font-bold text-green-700">{over3}</div>
                  <div className="text-gray-500">Over 3s</div>
                  <div className="text-xs text-green-600">{over3Staff} staff</div>
                </div>
              </div>
              <div className="mt-3 pt-3 border-t flex justify-between">
                <span className="text-gray-600">Total Children</span>
                <span className="font-bold text-indigo-700">{totalChildren}</span>
              </div>
            </div>

            <div className="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
              <h2 className="font-semibold text-gray-800 mb-4">Eldercare</h2>
              <div className="flex justify-between items-center">
                <div>
                  <div className="text-2xl font-bold text-purple-700">{elderUsers}</div>
                  <div className="text-sm text-gray-500">Elder day service users</div>
                </div>
                <div className="text-right">
                  <div className="text-xl font-bold text-purple-600">{elderStaff}</div>
                  <div className="text-sm text-gray-500">staff needed</div>
                </div>
              </div>
            </div>

            <div className="bg-indigo-600 rounded-xl shadow-lg p-6 text-white">
              <h2 className="font-semibold mb-4">Total Staffing Requirement</h2>
              <div className="grid grid-cols-3 gap-4 text-center">
                <div>
                  <div className="text-3xl font-bold">{totalChildcareStaff}</div>
                  <div className="text-indigo-200 text-sm">Childcare</div>
                </div>
                <div>
                  <div className="text-3xl font-bold">{elderStaff}</div>
                  <div className="text-indigo-200 text-sm">Eldercare</div>
                </div>
                <div>
                  <div className="text-3xl font-bold">{supportStaff}</div>
                  <div className="text-indigo-200 text-sm">Support*</div>
                </div>
              </div>
              <div className="mt-4 pt-4 border-t border-indigo-500 text-center">
                <div className="text-4xl font-bold">{totalStaff}</div>
                <div className="text-indigo-200">Total Care Personnel</div>
              </div>
              <div className="mt-3 text-xs text-indigo-300">*Support includes management, admin, kitchen, facilities (~20%)</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
